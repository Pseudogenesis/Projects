{
  "SaveName": "",
  "Date": "",
  "VersionNumber": "",
  "GameMode": "",
  "GameType": "",
  "GameComplexity": "",
  "Tags": [],
  "Gravity": 0.5,
  "PlayArea": 0.5,
  "Table": "",
  "Sky": "",
  "Note": "",
  "TabStates": {},
  "LuaScript": "",
  "LuaScriptState": "",
  "XmlUI": "",
  "ObjectStates": [
    {
      "GUID": "Tempers_of_the_Ever-Changing_Skies",
      "Name": "Custom_Tile",
      "Transform": {
        "posX": -45.6196632,
        "posY": 0.883320868,
        "posZ": 106.140053,
        "rotX": -7.73711E-06,
        "rotY": 179.99762,
        "rotZ": 0.5609969,
        "scaleX": 5.46,
        "scaleY": 1.0,
        "scaleZ": 5.46
      },
      "Nickname": "Tempers of the Ever-Changing Skies",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 0.2002995,
        "g": 0.16029951,
        "b": 0.15179953
      },
      "Tags": [
        "Spirit"
      ],
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": false,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "CustomImage": {
        "ImageURL": "https://steamusercontent-a.akamaihd.net/ugc/9970943713431201118/CBFAD90471C248223D5B9C740A9DC7F6CA73EDE7/",
        "ImageSecondaryURL": "https://steamusercontent-a.akamaihd.net/ugc/9970943713431201118/CBFAD90471C248223D5B9C740A9DC7F6CA73EDE7/",
        "ImageScalar": 1.0,
        "WidthScale": 0.0,
        "CustomTile": {
          "Type": 0,
          "Thickness": 0.2,
          "Stackable": false,
          "Stretch": true
        }
      },
      "LuaScript": "-- Spirit Panel for MJ & iakona's Spirit Island Mod --\nuseProgression = false\nuseAspect = 2\n\nfunction onLoad(saved_data)\n    Color.Add(\"SoftBlue\", Color.new(0.53,0.92,1))\n    Color.Add(\"SoftYellow\", Color.new(1,0.8,0.5))\n    getObjectFromGUID(\"SourceSpirit\").call(\"load\", {obj = self, saved_data = saved_data})\nend",
      "LuaScriptState": "{\"bonusEnergy\":[],\"thresholds\":[{\"elements\":\"02020000\",\"position\":{\"x\":0.34,\"y\":0,\"z\":0.45}}],\"trackElements\":[{\"elements\":\"01000000\",\"position\":{\"x\":-0.503,\"y\":0,\"z\":-0.4427}}],\"trackEnergy\":[{\"count\":3,\"position\":{\"x\":-0.9584,\"y\":0,\"z\":-0.4427}},{\"count\":2,\"position\":{\"x\":-0.2753,\"y\":0,\"z\":-0.4427}},{\"count\":1,\"position\":{\"x\":0.1801,\"y\":0,\"z\":-0.4427}}]}",
      "XmlUI": "",
      "AttachedSnapPoints": [
        {
          "Position": {
            "x": -0.0476,
            "y": 0.2,
            "z": -0.4427
          }
        },
        {
          "Position": {
            "x": -0.2753,
            "y": 0.2,
            "z": -0.4427
          }
        },
        {
          "Position": {
            "x": -0.503,
            "y": 0.2,
            "z": -0.4427
          }
        },
        {
          "Position": {
            "x": -0.7307,
            "y": 0.2,
            "z": -0.4427
          }
        },
        {
          "Position": {
            "x": -0.9584,
            "y": 0.2,
            "z": -0.4427
          }
        },
        {
          "Position": {
            "x": -0.0476,
            "y": 0.2,
            "z": -0.0743
          }
        },
        {
          "Position": {
            "x": -0.2753,
            "y": 0.2,
            "z": -0.0743
          }
        },
        {
          "Position": {
            "x": -0.503,
            "y": 0.2,
            "z": -0.0743
          }
        },
        {
          "Position": {
            "x": -0.7307,
            "y": 0.2,
            "z": -0.0743
          }
        },
        {
          "Position": {
            "x": -0.9584,
            "y": 0.2,
            "z": -0.0743
          }
        },
        {
          "Position": {
            "x": -1.1861,
            "y": 0.2,
            "z": -0.0743
          }
        }
      ],
      "ChildObjects": [
        {
          "GUID": "fddf31",
          "Name": "Custom_Model",
          "Transform": {
            "posX": 1.49495757,
            "posY": 0.208998352,
            "posZ": 0.9934842,
            "rotX": 0.5868266,
            "rotY": 85.65325,
            "rotZ": 2.40188527,
            "scaleX": 1.83413279,
            "scaleY": 9.917682,
            "scaleZ": 1.83165872
          },
          "Nickname": "Change Season Script",
          "Description": "",
          "GMNotes": "",
          "AltLookAngle": {
            "x": 0.0,
            "y": 0.0,
            "z": 0.0
          },
          "ColorDiffuse": {
            "r": 1.0,
            "g": 1.0,
            "b": 1.0
          },
          "Tags": [
            "Gain Pay",
            "Modify Cost",
            "Setup",
            "Time Passes"
          ],
          "LayoutGroupSortIndex": 0,
          "Value": 0,
          "Locked": false,
          "Grid": false,
          "Snap": false,
          "IgnoreFoW": false,
          "MeasureMovement": false,
          "DragSelectable": true,
          "Autoraise": true,
          "Sticky": true,
          "Tooltip": true,
          "GridProjection": false,
          "HideWhenFaceDown": false,
          "Hands": false,
          "CustomMesh": {
            "MeshURL": "https://steamusercontent-a.akamaihd.net/ugc/1754683441115249154/B284A821AE46B04E3399AE51B6B94ED0BEFC5F92/",
            "DiffuseURL": "",
            "NormalURL": "",
            "ColliderURL": "",
            "Convex": true,
            "MaterialIndex": 0,
            "TypeIndex": 0,
            "CastShadows": true
          },
          "LuaScript": "-- Season Change Script for Tempers of the Ever-Changing Skies --\n-- Runs from child object to avoid script wipe on panel load --\n\nlocal spiritName = \"Tempers of the Ever-Changing Skies\"\nlocal impendTable = {}\nlocal pos\n-- Wheel states: 1=Ire, 2=Joy, 3=Calm, 4=Sorrow\nlocal EMOTIONS = {\"Ire\", \"Joy\", \"Calm\", \"Sorrow\"}\nlocal seasonWheel = nil\nlocal activated = false\nlocal playerColor = nil\nlocal busy = false  -- Prevents rapid clicking\nlocal parentPanel = nil  -- Reference to parent spirit panel\n\n-----------------------------------------\n-- Forward declarations for local functions\n-----------------------------------------\nlocal getWheelEmotion\nlocal setWheelToEmotion\nlocal findInnateWithTagInHand\nlocal findInnateWithTagInHandObjects\nlocal getEmotionIndex\nlocal getNextEmotionIndex\nlocal cycleSeasonWheel\n\n-----------------------------------------\n-- Local function implementations\n-----------------------------------------\n\ngetWheelEmotion = function()\n    if not seasonWheel then return \"Ire\" end\n    local stateId = seasonWheel.getStateId()\n    if stateId == -1 then stateId = 1 end\n    -- States: 1=Ire, 2=Joy, 3=Calm, 4=Sorrow\n    return EMOTIONS[stateId] or \"Ire\"\nend\n\nsetWheelToEmotion = function(emotionTag)\n    if not seasonWheel then return end\n\n    -- Find which state index matches this emotion\n    local targetState = 1\n    for i, emotion in ipairs(EMOTIONS) do\n        if emotion == emotionTag then\n            targetState = i\n            break\n        end\n    end\n\n    local currentState = seasonWheel.getStateId()\n    if currentState == -1 then currentState = 1 end\n\n    -- Only change if different\n    if targetState ~= currentState then\n        seasonWheel = seasonWheel.setState(targetState)\n    end\nend\n\nfindInnateWithTagInHand = function(color, handIndex, tagName)\n    local hand = Player[color].getHandObjects(handIndex)\n    for _, obj in ipairs(hand) do\n        if obj.hasTag(\"Innate\") and obj.hasTag(tagName) then\n            return obj\n        end\n    end\n    return nil\nend\n\n-- Version that searches a provided hand objects table\nfindInnateWithTagInHandObjects = function(handObjects, tagName)\n    for _, obj in ipairs(handObjects) do\n        if obj.hasTag(\"Innate\") and obj.hasTag(tagName) then\n            return obj\n        end\n    end\n    return nil\nend\n\ngetEmotionIndex = function(card)\n    for i, tag in ipairs(EMOTIONS) do\n        if card.hasTag(tag) then return i end\n    end\n    return 1 -- default to Ire if none\nend\n\n-- Get the next emotion index (not tag) given a card\ngetNextEmotionIndex = function(card, reverse)\n    local i = getEmotionIndex(card)\n    if reverse then\n        -- Go backwards: 1->4, 2->1, 3->2, 4->3\n        return ((i - 2) % #EMOTIONS) + 1\n    else\n        -- Go forwards: 1->2, 2->3, 3->4, 4->1\n        return (i % #EMOTIONS) + 1\n    end\nend\n\ncycleSeasonWheel = function(reverse)\n    if not seasonWheel then return end\n\n    local currentState = seasonWheel.getStateId()\n    if currentState == -1 then return end -- No states\n\n    -- getStates() returns all states EXCEPT the current one, so total = #getStates + 1\n    local states = seasonWheel.getStates()\n    if not states then return end\n    local numStates = #states + 1\n\n    local nextState\n    if reverse then\n        -- Go backwards: 1->4, 2->1, 3->2, 4->3\n        nextState = ((currentState - 2) % numStates) + 1\n    else\n        -- Go forwards: 1->2, 2->3, 3->4, 4->1\n        nextState = (currentState % numStates) + 1\n    end\n\n    -- setState returns new object reference; update our reference\n    if nextState ~= currentState then\n        seasonWheel = seasonWheel.setState(nextState)\n    end\nend\n\n-----------------------------------------\n-- onLoad - Get parent panel reference\n-----------------------------------------\n\nfunction onLoad(saved_data)\n    -- Get reference to parent panel (the spirit panel)\n    Wait.frames(function()\n        parentPanel = self.getAttachments and self.getAttachments()[1] or nil\n        if not parentPanel then\n            -- Alternative: search by GUID or name\n            for _, obj in ipairs(getAllObjects()) do\n                if obj.getName() == spiritName and obj.hasTag(\"Spirit\") then\n                    parentPanel = obj\n                    break\n                end\n            end\n        end\n    end, 1)\nend\n\n-----------------------------------------\n-- Setup function (called by mod framework)\n-----------------------------------------\n\nfunction doSetup(params)\n    local color = params.color\n    playerColor = color\n    \n    -- Get the parent panel\n    parentPanel = self.getAttachments and self.getAttachments()[1] or nil\n    if not parentPanel then\n        -- Search for parent panel by name\n        for _, obj in ipairs(getAllObjects()) do\n            if obj.getName() == spiritName and obj.hasTag(\"Spirit\") then\n                parentPanel = obj\n                break\n            end\n        end\n    end\n    \n    if not parentPanel then\n        print(\"[Tempers] ERROR: Could not find parent panel!\")\n        return false\n    end\n\n    local position = parentPanel.getPosition() + Vector(-8.2,-0.22,6.8)\n    pos = position\n\n    -- Find the Season Wheel object by searching for it on the table\n    for _, obj in ipairs(getAllObjects()) do\n        if obj.getName():find(\"Season Wheel\") then\n            seasonWheel = obj\n            break\n        end\n    end\n\n    -- Spawn the new hand (hand index 3)\n    local handPosition = Player[color].getHandTransform(2).position\n    handPosition.z = handPosition.z - 5.5\n    Global.call(\"SpawnHand\", {color = color, position = handPosition})\n\n    -- Determine which emotion the wheel is currently showing\n    local startingEmotion = getWheelEmotion()\n\n    -- Get current hand and process Innate cards\n    local hand = Player[color].getHandObjects(1)\n    Wait.frames(function()\n        if hand ~= {} then\n            -- Find the card that matches the wheel's starting emotion\n            local startingCard = findInnateWithTagInHandObjects(hand, startingEmotion)\n\n            for _,card in pairs(hand) do\n                if card.hasTag(\"Innate\") then\n                    if card == startingCard then\n                        -- Place matching card directly on the panel\n                        local targetPos = pos + Vector(13, 0.5, -10)\n                        card.setPosition(targetPos, false)\n                    else\n                        -- Send other innates to hand 3\n                        card.deal(1, color, 3)\n                    end\n                end\n            end\n        end\n    end, 1)\n\n    createPanelButtons(parentPanel)\n\n    return true\nend\n\n-----------------------------------------\n-- Panel button creation\n-----------------------------------------\n\nfunction createPanelButtons(panel)\n    panel.createButton({\n        click_function = \"changeSeason\",\n        function_owner = self,  -- Callbacks go to this child object\n        label = \"Change Season\",\n        position = {-0.93,0.5,0},\n        scale = {x=0.08, y=0.08, z=0.08},\n        width = 5000,\n        height = 750,\n        font_size = 750,\n        color = {1,1,1},\n        font_color = {0,0,0},\n        tooltip = \"Left-click: Next Season | Right-click: Previous Season\",\n    })\nend\n\n-----------------------------------------\n-- Change Season (button click handler)\n-----------------------------------------\n\nfunction changeSeason(obj, player_color, alt_click)\n    -- Prevent rapid clicking while cards are moving\n    if busy then return end\n    busy = true\n\n    local color = Global.call(\"getSpiritColor\", {name = spiritName})\n    local reverse = alt_click -- true for right-click (go backwards)\n    \n    -- Use parent panel position for raycast\n    local panelPos = parentPanel and parentPanel.getPosition() or obj.getPosition()\n\n    local hits = Physics.cast({\n        origin = panelPos + Vector(5,0,-5),\n        direction = Vector(0,1,0),\n        type = 3,\n        size = {6,1,6.5},\n        max_distance = 1,\n        -- debug = true\n    })\n\n    -- First, find the innate card in the hits\n    local innateCard = nil\n    for _, hit in pairs(hits) do\n        local card = hit.hit_object\n        if card and card.hasTag(\"Innate\") then\n            innateCard = card\n            break\n        end\n    end\n\n    if innateCard then\n        local targetPos = innateCard.getPosition()\n        local targetRot = innateCard.getRotation()\n\n        -- Calculate the NEXT emotion index based on current card\n        local nextIndex = getNextEmotionIndex(innateCard, reverse)\n        local wantTag = EMOTIONS[nextIndex]\n\n        -- Move the current card to hand 3\n        innateCard.deal(1, color, 3)\n\n        -- Pull the next emotion card from hand 3 back to the panel\n        local replacement = findInnateWithTagInHand(color, 3, wantTag)\n        if replacement then\n            replacement.setPosition(targetPos, false)\n            replacement.setRotation(targetRot, false)\n        end\n\n        -- Set the wheel directly to the NEW emotion state\n        setWheelToEmotion(wantTag)\n    else\n        -- No innate on panel, place the default (Ire)\n        local replacement = findInnateWithTagInHand(color, 3, \"Ire\")\n        if replacement then\n            replacement.setPosition(pos + Vector(13,0.5,-10), false)\n        end\n    end\n\n    -- Release busy flag after cards have time to move\n    Wait.frames(function()\n        busy = false\n    end, 20)\nend\n\n-----------------------------------------\n-- Time Passes handler (called by mod framework)\n-----------------------------------------\n\nfunction timePasses()\n    local color = Global.call(\"getSpiritColor\", {name = spiritName})\n    \n    -- Use parent panel position for raycast\n    local panelPos = parentPanel and parentPanel.getPosition() or self.getPosition()\n    \n    local hits = Physics.cast({\n        origin = panelPos + Vector(5,0,-5),\n        direction = Vector(0,1,0),\n        type = 3,\n        size = {6,1,6.5},\n        max_distance = 1,\n        -- debug = true\n    })\n\n    -- First, find the innate card in the hits\n    local innateCard = nil\n    for _, hit in pairs(hits) do\n        local card = hit.hit_object\n        if card and card.hasTag(\"Innate\") then\n            innateCard = card\n            break\n        end\n    end\n\n    if innateCard then\n        local targetPos = innateCard.getPosition()\n        local targetRot = innateCard.getRotation()\n\n        -- Calculate the NEXT emotion index (always forward for timePasses)\n        local nextIndex = getNextEmotionIndex(innateCard, false)\n        local wantTag = EMOTIONS[nextIndex]\n\n        -- Move the current card to hand 3\n        innateCard.deal(1, color, 3)\n\n        -- Pull the next emotion card from hand 3 back to the panel\n        local replacement = findInnateWithTagInHand(color, 3, wantTag)\n        if replacement then\n            replacement.setPosition(targetPos, false)\n            replacement.setRotation(targetRot, false)\n        end\n\n        -- Set the wheel directly to the NEW emotion state\n        setWheelToEmotion(wantTag)\n    else\n        -- No innate on panel, place the default (Ire)\n        local replacement = findInnateWithTagInHand(color, 3, \"Ire\")\n        if replacement then\n            replacement.setPosition(pos + Vector(13,0.5,-10), false)\n        end\n    end\nend\n\n-----------------------------------------\n-- Cost modification (called by mod framework)\n-----------------------------------------\n\nfunction modifyCost(params)\n    local costs = params.costs\n    if params.color == Global.call(\"getSpiritColor\", {name = spiritName}) then\n        for guid,_ in pairs(costs) do\n            if impendTable[guid] then\n                costs[guid] = 0\n            end\n        end\n    end\n    return costs\nend\n",
          "LuaScriptState": "",
          "XmlUI": ""
        }
      ]
    }
  ]
}