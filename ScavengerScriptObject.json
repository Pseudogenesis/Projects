{
  "SaveName": "",
  "Date": "",
  "VersionNumber": "",
  "GameMode": "",
  "GameType": "",
  "GameComplexity": "",
  "Tags": [],
  "Gravity": 0.5,
  "PlayArea": 0.5,
  "Table": "",
  "Sky": "",
  "Note": "",
  "TabStates": {},
  "LuaScript": "",
  "LuaScriptState": "",
  "XmlUI": "",
  "ObjectStates": [
    {
      "GUID": "scvngr",
      "Name": "BlockSquare",
      "Transform": {
        "posX": 0.0,
        "posY": 1.0,
        "posZ": 0.0,
        "rotX": 0.0,
        "rotY": 0.0,
        "rotZ": 0.0,
        "scaleX": 0.1,
        "scaleY": 0.1,
        "scaleZ": 0.1
      },
      "Nickname": "Scavenger Script Handler",
      "Description": "Position this object where you want scavenged tokens to land, then group/lock with the spirit panel.",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 0.0,
        "g": 0.0,
        "b": 0.0
      },
      "Tags": [],
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": false,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "LuaScript": "--[[\r\n    Scavenger of Fates - Scavenging Automation Script\r\n\r\n    This script lives in an invisible child object attached to the Scavenger of Fates spirit panel.\r\n    It adds a \"Scavenge Token\" context menu option to Beasts, Badlands, Wilds, and Disease tokens,\r\n    allowing any player to send them to this script object's position on the spirit panel.\r\n\r\n    Also registers a hotkey \"Scavenge Token\" that players can bind in Options > Game Keys.\r\n\r\n    Setup: Position this object where you want scavenged tokens to land, then group/lock\r\n    it with the Scavenger of Fates spirit panel.\r\n]]--\r\n\r\n-- Configuration\r\nlocal SCAVENGEABLE_TYPES = {\"Beasts\", \"Badlands\", \"Wilds\", \"Disease\"}\r\nlocal MENU_LABEL = \"Scavenge Token\"\r\nlocal HOTKEY_LABEL = \"Scavenge Token\"\r\n\r\n-- Track which objects have been given the context menu\r\nlocal registeredObjects = {}\r\n\r\n--[[\r\n    Check if an object is a scavengeable token type\r\n    Uses both name and tag checking for reliability\r\n]]--\r\nfunction isScavengeable(obj)\r\n    if obj == nil then return false end\r\n\r\n    local objName = obj.getName()\r\n\r\n    for _, tokenType in ipairs(SCAVENGEABLE_TYPES) do\r\n        -- Check by name\r\n        if objName == tokenType then\r\n            return true\r\n        end\r\n        -- Check by tag as backup\r\n        if obj.hasTag and obj.hasTag(tokenType) then\r\n            return true\r\n        end\r\n    end\r\n\r\n    return false\r\nend\r\n\r\n--[[\r\n    Move a token to the scavenging area\r\n]]--\r\nfunction scavengeToken(playerColor, tokenObject)\r\n    if tokenObject == nil then\r\n        return false\r\n    end\r\n\r\n    -- Get this script object's position as the target\r\n    local targetPos = self.getPosition()\r\n\r\n    -- Add a small random offset to prevent tokens from stacking exactly on top of each other\r\n    local randomOffset = {\r\n        x = (math.random() - 0.5) * 0.5,\r\n        z = (math.random() - 0.5) * 0.5\r\n    }\r\n\r\n    targetPos.x = targetPos.x + randomOffset.x\r\n    targetPos.z = targetPos.z + randomOffset.z\r\n    targetPos.y = targetPos.y + 0.5  -- Slightly above to drop onto surface\r\n\r\n    -- Move the token smoothly to the scavenging area\r\n    tokenObject.setPositionSmooth(targetPos, false, true)\r\n\r\n    -- Provide feedback to the player\r\n    local tokenName = tokenObject.getName()\r\n    broadcastToAll(playerColor .. \" scavenged a \" .. tokenName .. \" token.\", {0.8, 0.6, 1})\r\n\r\n    return true\r\nend\r\n\r\n--[[\r\n    Callback function when \"Scavenge Token\" is selected from context menu\r\n    Moves the clicked object to this script object's position\r\n]]--\r\nfunction onScavengeToken(playerColor, position, clickedObject)\r\n    if clickedObject == nil then\r\n        printToColor(\"Error: No object to scavenge.\", playerColor, {1, 0.5, 0})\r\n        return\r\n    end\r\n\r\n    scavengeToken(playerColor, clickedObject)\r\nend\r\n\r\n--[[\r\n    Hotkey callback - scavenges the object the player is hovering over\r\n]]--\r\nfunction onScavengeHotkey(playerColor, hoveredObject, pointerPosition, isKeyUp)\r\n    -- Only trigger on key down, not key up\r\n    if isKeyUp then return end\r\n\r\n    if hoveredObject == nil then\r\n        printToColor(\"No object under cursor to scavenge.\", playerColor, {1, 0.5, 0})\r\n        return\r\n    end\r\n\r\n    if not isScavengeable(hoveredObject) then\r\n        printToColor(\"This object cannot be scavenged.\", playerColor, {1, 0.5, 0})\r\n        return\r\n    end\r\n\r\n    scavengeToken(playerColor, hoveredObject)\r\nend\r\n\r\n--[[\r\n    Add the scavenge context menu option to a single object\r\n]]--\r\nfunction addScavengeMenu(obj)\r\n    if obj == nil then return end\r\n\r\n    local guid = obj.getGUID()\r\n\r\n    -- Skip if already registered\r\n    if registeredObjects[guid] then\r\n        return\r\n    end\r\n\r\n    -- Only add to scavengeable token types\r\n    if not isScavengeable(obj) then\r\n        return\r\n    end\r\n\r\n    -- Add the context menu item\r\n    obj.addContextMenuItem(MENU_LABEL, onScavengeToken, false)\r\n    registeredObjects[guid] = true\r\nend\r\n\r\n--[[\r\n    Scan all objects and add context menus to scavengeable tokens\r\n]]--\r\nfunction registerAllTokens()\r\n    for _, obj in ipairs(getObjects()) do\r\n        addScavengeMenu(obj)\r\n    end\r\nend\r\n\r\n--[[\r\n    Event handler: Called when any object is spawned/created\r\n]]--\r\nfunction onObjectSpawn(obj)\r\n    -- Small delay to ensure the object is fully initialized\r\n    Wait.time(function()\r\n        addScavengeMenu(obj)\r\n    end, 0.5)\r\nend\r\n\r\n--[[\r\n    Event handler: Called when an object is destroyed\r\n    Cleans up our tracking table\r\n]]--\r\nfunction onObjectDestroy(obj)\r\n    if obj ~= nil then\r\n        local guid = obj.getGUID()\r\n        if guid and registeredObjects[guid] then\r\n            registeredObjects[guid] = nil\r\n        end\r\n    end\r\nend\r\n\r\n--[[\r\n    Event handler: Called when this script object loads\r\n]]--\r\nfunction onLoad(savedData)\r\n    -- Register the scavenge hotkey (players bind it in Options > Game Keys)\r\n    addHotkey(HOTKEY_LABEL, onScavengeHotkey, true)\r\n\r\n    -- Small delay to ensure all objects are loaded before scanning\r\n    Wait.time(function()\r\n        registerAllTokens()\r\n        print(\"[Scavenger Script] Scavenging automation initialized.\")\r\n        print(\"[Scavenger Script] Bind the 'Scavenge Token' hotkey in Options > Game Keys.\")\r\n    end, 1)\r\nend",
      "LuaScriptState": "",
      "XmlUI": ""
    }
  ]
}
